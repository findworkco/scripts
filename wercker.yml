# Use Ubuntu@14.04 as our box image
# https://hub.docker.com/_/ubuntu/
box: ubuntu:14.04

# Use a common build setup for default and diff builds
init-build:
  steps:
    # Install our dependencies
    - script:
        name: install system dependencies
        code: |
          apt-get update
          # Ruby for Bundler
          # curl, wget, etc for Ubuntu/Chef
          apt-get install -y ruby1.9.1 curl wget
    - script:
        name: install bundler
        code: gem install bundler
    - script:
        name: echo ruby information
        code: |
          echo "ruby version $(ruby --version) running"
          echo "bundle version $(bundle --version) running"
    - script:
        name: install dependencies
        code: bundle install

# Run our default build
default-build:
    # Run our provisioner
    - script:
        name: bootstrap system
        code: bin/bootstrap-wercker.sh

    # Run our tests
    - script:
        name: run tests
        code: bin/test-wercker.sh
